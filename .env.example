# ============================================================================
# DBPower AI Cloud - Environment Configuration
# ============================================================================
# Copy this file to .env and customize for your environment
#
# Quick Start (Development):
#   cp .env.example .env
#   docker-compose up -d
#
# Production: Change all passwords, secrets, and disable demo organization
# ============================================================================

# ----------------------------------------------------------------------------
# Database Configuration (Internal PostgreSQL)
# ----------------------------------------------------------------------------
# The internal database stores organizations, users, queries, and analysis results

# Database type: postgresql (production) or sqlite (development/testing)
DB_TYPE=postgresql

# PostgreSQL connection (used when DB_TYPE=postgresql)
DB_HOST=internal-db
DB_PORT=5432
DB_NAME=ai_core
DB_USER=ai_core
DB_PASSWORD=ai_core

# SQLite path (used when DB_TYPE=sqlite)
# DB_PATH=./dev.db

# Database connection pooling
DB_POOL_SIZE=20
DB_MAX_OVERFLOW=10

# SQL query logging (true = verbose, false = quiet)
SQL_ECHO=false

# ----------------------------------------------------------------------------
# Redis Configuration (Cache & Rate Limiting)
# ----------------------------------------------------------------------------
REDIS_HOST=redis
REDIS_PORT=6379
REDIS_URL=redis://redis:6379/0
# REDIS_PASSWORD=  # Uncomment and set for production

# ----------------------------------------------------------------------------
# JWT Authentication Configuration
# ----------------------------------------------------------------------------
# IMPORTANT: Change JWT_SECRET_KEY in production!
# Generate with: openssl rand -hex 32

JWT_SECRET_KEY=your-secret-key-change-in-production
JWT_ALGORITHM=HS256
JWT_ACCESS_TOKEN_EXPIRE_MINUTES=30
JWT_REFRESH_TOKEN_EXPIRE_DAYS=7

# ----------------------------------------------------------------------------
# Super Admin Configuration
# ----------------------------------------------------------------------------
# The super admin user is created automatically on first startup

SUPER_ADMIN_EMAIL=admin@dbpower.local
SUPER_ADMIN_PASSWORD=admin123
SUPER_ADMIN_NAME=Super Administrator

# ----------------------------------------------------------------------------
# Demo Organization Configuration
# ----------------------------------------------------------------------------
# Set to true to create a demo organization with sample users
# Set to false in production

CREATE_DEMO_ORG=true

# Demo organization will create:
# - "Demo Company" organization
# - 2 teams: "Engineering" and "Data Team"
# - 3 identities for testing
# - 3 demo users:
#     orgadmin@demo.com / demo123 (Org Admin)
#     teamlead@demo.com / demo123 (Team Lead)
#     user@demo.com / demo123 (User)

# ----------------------------------------------------------------------------
# AI Provider Configuration
# ----------------------------------------------------------------------------
# Options: stub, openai, ollama

AI_PROVIDER=stub

# OpenAI Configuration (when AI_PROVIDER=openai)
# AI_API_KEY=sk-your-openai-api-key-here
# AI_MODEL=gpt-4

# Ollama Configuration (when AI_PROVIDER=ollama, for on-premise AI)
# OLLAMA_BASE_URL=http://ollama:11434
# OLLAMA_MODEL=llama2

# AI Analysis Settings
AI_ANALYSIS_TIMEOUT=30  # seconds
AI_MAX_RETRIES=3

# ----------------------------------------------------------------------------
# API Gateway Configuration
# ----------------------------------------------------------------------------
# The API Gateway provides rate limiting, authentication, and routing

# Service identification
SERVICE_NAME=dbpower-api-gateway
GATEWAY_HOST=0.0.0.0
GATEWAY_PORT=8000

# Backend service URLs (internal Docker network names)
BACKEND_URL=http://backend:8000
AI_ANALYZER_URL=http://ai-analyzer:8001

# Rate Limiting (per organization)
RATE_LIMIT_REQUESTS_PER_MINUTE=100
RATE_LIMIT_REQUESTS_PER_HOUR=1000

# Per-IP rate limits (prevents abuse)
RATE_LIMIT_PER_IP_PER_MINUTE=200

# ----------------------------------------------------------------------------
# Backend API Configuration
# ----------------------------------------------------------------------------
# The backend provides the main REST API for the platform

# Server settings
BACKEND_HOST=0.0.0.0
BACKEND_PORT=8000
BACKEND_WORKERS=4  # Number of Uvicorn workers (adjust based on CPU cores)

# CORS settings (comma-separated origins)
CORS_ORIGINS=http://localhost:3000,http://localhost:8080

# ----------------------------------------------------------------------------
# AI Analyzer Microservice Configuration
# ----------------------------------------------------------------------------
# The AI Analyzer provides query analysis using AI providers

ANALYZER_HOST=0.0.0.0
ANALYZER_PORT=8001

# ----------------------------------------------------------------------------
# Admin Panel Configuration
# ----------------------------------------------------------------------------
# The admin panel is a React SPA served by Nginx

# API base URL (leave empty to use relative paths with nginx proxy)
VITE_API_BASE_URL=

# In development, Vite proxy handles API requests to http://localhost:8080

# ----------------------------------------------------------------------------
# Logging Configuration
# ----------------------------------------------------------------------------
# Log levels: DEBUG, INFO, WARNING, ERROR, CRITICAL

LOG_LEVEL=INFO
LOG_FORMAT=json  # json or text

# Enable request logging
LOG_REQUESTS=true

# Enable SQL query logging (performance impact!)
LOG_SQL=false

# ----------------------------------------------------------------------------
# Security Configuration
# ----------------------------------------------------------------------------
# Security settings for production deployments

# Enable HTTPS redirect (set to true in production with SSL/TLS)
FORCE_HTTPS=false

# Trusted proxy IPs (for X-Forwarded-For headers)
# TRUSTED_PROXIES=127.0.0.1,10.0.0.0/8

# Session cookie settings
COOKIE_SECURE=false  # Set to true in production with HTTPS
COOKIE_SAMESITE=lax  # lax, strict, or none
COOKIE_HTTPONLY=true

# ----------------------------------------------------------------------------
# Monitoring & Telemetry Configuration (Optional)
# ----------------------------------------------------------------------------
# Uncomment to enable monitoring integrations

# Sentry (Error tracking)
# SENTRY_DSN=https://xxxxx@sentry.io/xxxxx
# SENTRY_ENVIRONMENT=production

# Prometheus metrics
# ENABLE_METRICS=true
# METRICS_PORT=9090

# Health check settings
HEALTH_CHECK_INTERVAL=30  # seconds

# ----------------------------------------------------------------------------
# Feature Flags (Optional)
# ----------------------------------------------------------------------------
# Enable or disable specific features

ENABLE_API_DOCS=true  # Swagger UI at /docs
ENABLE_AUDIT_LOGS=true  # Compliance logging
ENABLE_RATE_LIMITING=true  # API rate limiting
ENABLE_QUERY_ANONYMIZATION=true  # PII protection in queries

# ----------------------------------------------------------------------------
# Development Settings
# ----------------------------------------------------------------------------
# Settings useful for development (disable in production)

# Environment mode
ENV=development  # development or production

# Enable hot reload for backend (Docker volume mount required)
BACKEND_RELOAD=true

# Enable debug mode (detailed error messages, don't use in production!)
DEBUG=false

# ----------------------------------------------------------------------------
# Backup Configuration (Production)
# ----------------------------------------------------------------------------
# Configure automated backups

# BACKUP_ENABLED=true
# BACKUP_SCHEDULE=0 2 * * *  # Cron format: daily at 2 AM
# BACKUP_RETENTION_DAYS=30
# BACKUP_S3_BUCKET=dbpower-backups
# BACKUP_S3_REGION=us-east-1

# ----------------------------------------------------------------------------
# Email Configuration (Optional, for notifications)
# ----------------------------------------------------------------------------
# SMTP settings for email notifications

# SMTP_HOST=smtp.gmail.com
# SMTP_PORT=587
# SMTP_USER=your-email@gmail.com
# SMTP_PASSWORD=your-app-password
# SMTP_FROM=noreply@yourcompany.com
# SMTP_TLS=true

# ----------------------------------------------------------------------------
# Advanced Settings
# ----------------------------------------------------------------------------
# These settings are for advanced use cases

# Query collection settings
QUERY_COLLECTION_INTERVAL=300  # seconds (5 minutes)
QUERY_ANALYSIS_INTERVAL=600  # seconds (10 minutes)
QUERY_MIN_DURATION_MS=1000  # Only collect queries slower than this

# Query retention
QUERY_RETENTION_DAYS=90  # Delete queries older than this

# Analysis settings
ANALYSIS_BATCH_SIZE=100  # Number of queries to analyze at once
ANALYSIS_CONCURRENCY=5  # Parallel analysis workers

# Client agent settings
AGENT_HEARTBEAT_TIMEOUT=300  # seconds (5 minutes)
AGENT_MAX_RECONNECT_ATTEMPTS=10

# Database connection timeouts
DB_CONNECT_TIMEOUT=10  # seconds
DB_COMMAND_TIMEOUT=30  # seconds

# ----------------------------------------------------------------------------
# End of Configuration
# ============================================================================
#
# Need help? See documentation:
# - BOOTSTRAP_GUIDE.md - Complete setup guide
# - README.md - Project overview
# - ENVIRONMENT_GUIDE.md - Detailed environment configuration
#
# ============================================================================
